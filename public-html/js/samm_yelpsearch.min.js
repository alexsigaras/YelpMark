function updateBookmarks(){var e=bookmark.getItem("bookmarks","object"),t=getBookmarkDistinctCategories(e);t.length>0?($("#bookmarkCategorySelect").empty(),$("#bookmarkCategorySelect").append('<br /><select id="bmstars"><option value="all">All</option><option value="above2Stars">more than 2 stars</option><option value="above3Stars">more than 3 stars</option><option value="above4Stars">more than 4 stars</option></select><br />'),$("#bookmarkCategorySelect").append("<table>")):($("#bookmarkCategorySelect").empty(),$("#bookmarkCategorySelect").append("<h2>Bookmarks<h2>"));for(var a=0;a<t.length;a++)$("#bookmarkCategorySelect").append('<tr><td><input class="categorySelect" type="checkbox" value="'+t[a][1]+'"></input></td><td>'+t[a][0]+"</td></tr>"),totalCats.push(t[a][1]);$(".categorySelect","#bookmarkCategorySelect").each(function(){this.checked=!0});for(var a=0;a<t.length;a++)cats.push(t[a][1]);if($("#bookmarkCategorySelect").append("</table>"),$("#bmstars").change(function(){redrawBookmarks()}),$(".categorySelect","#bookmarkCategorySelect").each(function(){$(this).click(function(){$(this).is(":checked")?cats.push($(this).val()):cats.splice(cats.indexOf($(this).val()),1),redrawBookmarks()})}),$("#BookmarkPanel").empty(),deleteBookInfoWindows(),deleteBookMarks(),e&&e.length>0){var s=$("<div class='deleteAllBookmarks'><button class='btn btn-small' title='Delete All Bookmarks' onclick='deleteAllBookmarks();'><i class='icon-trash'></i></button>Delete All</div>");s.click(function(){}),s.appendTo($("#BookmarkPanel"));for(var o=0;o<e.length;o++){var r=$("<div class='eachResult'></div>"),n=$("<div class='resultText' style='float: right;'></div>"),i=$("<div style='float:left; width: 50px; padding: 5px;'></div>"),l=$("<button class='btn btn-small "+o+"' title='More Info'><i class='icon-question-sign'></i></button>"),c=JSON.parse(e[o].obj),m=$("<input type='hidden' class='locationUrl' value='"+c.url+"'/>"),u=$("<input type='hidden' class='locationId' value='"+e[o].id+"'/>");if(pos)var p=$('<button id="iwBookButton" class="btn btn-small" style="" style="margin-top: 2px" title="Get Driving Directions" onclick="calcRoute('+c.location.coordinate.latitude+", "+c.location.coordinate.longitude+');"><i class="icon-road"></i></button>');addBookMarker(c,o),showBookMarks(),l.click(function(){for(var e=JSON.parse(bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].obj),t="",a=0;a<e.categories.length;a++)t+=e.categories[a][0]+", ";$("#venueTitle").html("<a target='_blank' href='"+e.url+"'>"+e.name+"</a><br /><span class='categories'> "+t+"</span>"),void 0!=e.image_url?$("#venueImage").html("<img src='"+e.image_url+"' />"):$("#venueImage").html("<img src='images/defaultBusiness.png' />");for(var s="",a=0;a<e.location.display_address.length;a++)s+=e.location.display_address[a]+"<br />";$("#venueAddress").html("<span style='font-weight: bold'>"+e.display_phone+"</span><br />"+s),pos&&($("#venueDirections").empty(),$("#venueDirections").html(p)),$("#venueRating").html("<img src='"+e.rating_img_url+"' /><br />"+e.rating+" / 5 from "+e.review_count+" reviews."),$("#venueSnippet").html(e.snippet_text),bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].comment?$("#venueComment").html("Comment: "+bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].comment):$("#venueComment").html("No comment.");for(var o="<span class='venueTags'>Your tags: ",a=0;a<bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].tags.length;a++)o+=bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].tags[a]+", ";o+="</span>",$("#venueTags").html(o),$("#modal").modal("show")}),i.append(l).append(m).append(u).append(editBookmarkButton(e[o].id)).append(deleteBookmarkButton(e[o].id,c.url)),void 0!=c.image_url?r.append("<img style='width: 50px; height: auto; margin: 5px; float: left;' src='"+c.image_url+"' />"):r.append("<img style='width: 50px; height: auto; margin: 5px; float: left;' src='images/defaultBusiness.png' />"),r.append(i),n.append("<div style='max-width: 100px; float: right'; padding: 5px;><span style='text-align: right; float: right;'>"+c.name+"</span><br /><img style='margin-top: 5px; float: right;' src='"+c.rating_img_url+"' /></div>"),r.append(n),$("#BookmarkPanel").append(r)}}}function containsTags(e,t){for(var a=0;a<e.length;a++)if(contains2(t,e[a][1]))return!0;return!1}function contains2(e,t){for(var a=e.length;a--;)if(e[a]==t)return!0;return!1}function redrawSearch(){$("#searchResultPanel").empty();var e=0;deleteSearchMarks(),deleteInfoWindows();var t;t="all"!=$("#searchstars").val()?yelpFilterResultsBy(results,$("#searchstars").val()):results,$(t).each(function(){if(containsTags(this.categories,distinctSolo)){var t=$("<div class='eachResult'></div>"),a=$("<div class='resultText' style='float: right;'></div>"),s=$("<div style='float:left; width: 50px; padding: 5px;'></div>");if(pos)var o=$('<button id="iwBookButton" class="btn btn-small" style="" style="margin-top: 2px" title="Get Driving Directions" onclick="calcRoute('+this.location.coordinate.latitude+", "+this.location.coordinate.longitude+');"><i class="icon-road"></i></button>');var r=$("<button class='btn btn-small addBookmark' style=' style='margin-top: 2px' title='Add Bookmark'><i class='icon-bookmark'></i></button>"),n=$("<input type='hidden' class='locationUrl' value='"+this.url+"'/>");bookmark.alreadyBookmark(this)&&r.attr({disabled:"disabled",title:""});var i=$("<button class='btn btn-small' title='More Info'><i class='icon-question-sign'></i></button>"),l=this;i.click(function(){for(var e="",t=0;t<l.categories.length;t++)e+=l.categories[t][0]+", ";$("#venueTitle").html("<a target='_blank' href='"+l.url+"'>"+l.name+"</a><br /><span class='categories'> "+e+"</span>"),void 0!=l.image_url?$("#venueImage").html("<img src='"+l.image_url+"' />"):$("#venueImage").html("<img src='images/defaultBusiness.png' />");for(var a="",t=0;t<l.location.display_address.length;t++)a+=l.location.display_address[t]+"<br />";$("#venueAddress").html("<span style='font-weight: bold'>"+l.display_phone+"</span><br />"+a),pos&&($("#venueDirections").empty(),$("#venueDirections").html(o)),$("#venueRating").html("<img src='"+l.rating_img_url+"' /><br />"+l.rating+" / 5 from "+l.review_count+" reviews."),$("#venueSnippet").html(l.snippet_text),$("#venueComment").html(""),$("#venueTags").html(""),$("#modal").modal("show")});var c;c=void 0!=l.image_url?l.image_url:"images/defaultBusiness.png",addResultMarker(this,e),e+=1,s.append(i).append(r).append(n),void 0!=this.image_url?t.append("<img style='width: 50px; height: auto; margin: 5px; float: left;' src='"+this.image_url+"' />"):t.append("<img style='width: 50px; height: auto; margin: 5px; float: left;' src='images/defaultBusiness.png' />"),t.append(s),a.append("<div style='max-width: 100px; float: right'; padding: 5px;><span style='text-align: right; float: right;'>"+this.name+"</span><br /><img style='margin-top: 5px; float: right;' src='"+this.rating_img_url+"' /></div>"),r.click(function(){addBookmarkBtnClick(l,$(this))}),t.append(a),$("#searchResultPanel").append(t)}}),showSearchMarks(),lock=!1}function redrawBookmarks(){var e=bookmark.getItem("bookmarks","object");if("all"!=$("#bmstars").val()&&(e=yelpFilterBookmarksBy(e,$("#bmstars").val())),$("#BookmarkPanel").empty(),deleteBookInfoWindows(),deleteBookMarks(),e.length>0){$("<div class='deleteAllBookmarks'><button class='btn btn-small' title='Delete All Bookmarks' onclick='deleteAllBookmarks();'><i class='icon-trash'></i></button></div>").appendTo($("#BookmarkPanel"));for(var t=0;t<e.length;t++){var a=JSON.parse(e[t].obj).categories;if(a&&containsTags(a,cats)){var s=$("<div class='eachResult'></div>"),o=$("<div class='resultText' style='float: right;'></div>"),r=$("<div style='float:left; width: 50px; padding: 5px;'></div>"),n=$("<button class='btn btn-small "+t+"' title='More Info'><i class='icon-question-sign'></i></button>"),i=JSON.parse(e[t].obj),l=$("<input type='hidden' class='locationUrl' value='"+i.url+"'/>"),c=$("<input type='hidden' class='locationId' value='"+e[t].id+"'/>");addBookMarker(i,t),showBookMarks(),n.click(function(){for(var e=JSON.parse(bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].obj),t="",a=0;a<e.categories.length;a++)t+=e.categories[a][0]+", ";$("#venueTitle").html("<a target='_blank' href='"+e.url+"'>"+e.name+"</a><br /><span class='categories'> "+t+"</span>"),void 0!=e.image_url?$("#venueImage").html("<img src='"+e.image_url+"' />"):$("#venueImage").html("<img src='images/defaultBusiness.png' />");for(var s="",a=0;a<e.location.display_address.length;a++)s+=e.location.display_address[a]+"<br />";$("#venueAddress").html("<span style='font-weight: bold'>"+e.display_phone+"</span><br />"+s),$("#venueRating").html("<img src='"+e.rating_img_url+"' /><br />"+e.rating+" / 5 from "+e.review_count+" reviews."),$("#venueSnippet").html(e.snippet_text),bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].comment?$("#venueComment").html("Comment: "+bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].comment):$("#venueComment").html("No comment.");for(var o="<span class='venueTags'>Your tags: ",a=0;a<bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].tags.length;a++)o+=bookmark.getItem("bookmarks")[$(this).attr("class").split(" ")[2]].tags[a]+", ";o+="</span>",$("#venueTags").html(o),$("#modal").modal("show")}),r.append(n).append(l).append(c).append(editBookmarkButton(e[t].id)).append(deleteBookmarkButton(e[t].id,i.url)),void 0!=i.image_url?s.append("<img style='width: 50px; height: auto; margin: 5px; float: left;' src='"+i.image_url+"' />"):s.append("<img style='width: 50px; height: auto; margin: 5px; float: left;' src='images/defaultBusiness.png' />"),s.append(r),o.append("<div style='max-width: 100px; float: right'; padding: 5px;><span style='text-align: right; float: right;'>"+i.name+"</span><br /><img style='margin-top: 5px; float: right;' src='"+i.rating_img_url+"' /></div>"),s.append(o),$("#BookmarkPanel").append(s)}}}}function processData(e){maxOffset=e.total;var t=new Array;if(distinctSolo.length==distinct.length){$("#categorySelect").empty(),$("#categorySelect").append('<br /><select id="searchstars"><option value="all">All</option><option value="above2Stars">more than 2 stars</option><option value="above3Stars">more than 3 stars</option><option value="above4Stars">more than 4 stars</option></select><br />'),$("#searchstars").change(function(){redrawSearch()});for(var a=getSearchResultDistinctCategories(e),s=0;s<a.length;s++)contains(distinct,a[s])||(distinct.push(a[s]),distinctSolo.push(a[s][1]));t=distinct;for(var s=0;s<t.length;s++)$("#categorySelect").append('<input class="categorySelect" type="checkbox" value="'+t[s][1]+'"></input>'+t[s][0]+"<br />");$(".categorySelect","#categorySelect").each(function(){this.checked=!0})}else{for(var a=getSearchResultDistinctCategories(e),s=0;s<a.length;s++)contains(distinct,a[s])||(distinct.push(a[s]),t.push(a[s]));for(var s=0;s<t.length;s++)$("#categorySelect").append('<input class="categorySelect checkMe" type="checkbox" value="'+t[s][1]+'"></input>'+t[s][0]+"<br />");$(".checkMe","#categorySelect").each(function(){this.checked=!0})}$(".categorySelect","#categorySelect").each(function(){$(this).unbind(),$(this).click(function(){$(this).is(":checked")?distinctSolo.push($(this).val()):distinctSolo.splice(distinctSolo.indexOf($(this).val()),1),items="";for(var e=0;e<distinctSolo.length;e++)items+=distinctSolo[e],e!=distinctSolo.length-1&&(items+=",");redrawSearch()})});for(var s=0;s<e.businesses.length;s++)results.push(e.businesses[s]);redrawSearch()}function callAddBookmark(e,t,a,s){bookmark.add(e,t,a),s&&(s.addClass("disabled"),s.attr({disabled:"disabled",title:""}));for(var o=0;o<e.categories.length;o++)contains(totalCats,e.categories[o][1])||(totalCats.push(e.categories[o][1]),cats.push(e.categories[o][1]),$("#bookmarkCategorySelect").append('<input class="categorySelect toCheck" type="checkbox" value="'+e.categories[o][1]+'"></input></td><td>'+e.categories[o][0]+"<br />"),$(".toCheck","#bookmarkCategorySelect").each(function(){this.checked=!0,$(this).removeClass("toCheck")}));redrawBookmarks()}function yelpSearch(e,t,a,s,o){var r=e,n=t,i={consumerSecret:auth.consumerSecret,tokenSecret:auth.accessTokenSecret};parameters=[],parameters.push(["term",r]),parameters.push(["location",n]),parameters.push(["offset",a]),parameters.push(["sort",s]),""!=o&&parameters.push(["category_filter",o]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",auth.consumerKey]),parameters.push(["oauth_consumer_secret",auth.consumerSecret]),parameters.push(["oauth_token",auth.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var l={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(l),OAuth.SignatureMethod.sign(l,i);var c=OAuth.getParameterMap(l.parameters);c.oauth_signature=OAuth.percentEncode(c.oauth_signature),console.log(c),a<=maxOffset&&$.ajax({url:l.action,data:c,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(e,t,a){processData(e)}})}function yelpSearchCurrentLocation(e,t,a,s,o,r){var n=e,i=t+","+a,l={consumerSecret:auth.consumerSecret,tokenSecret:auth.accessTokenSecret};parameters=[],parameters.push(["term",n]),parameters.push(["ll",i]),parameters.push(["offset",s]),parameters.push(["sort",o]),""!=r&&parameters.push(["category_filter",r]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",auth.consumerKey]),parameters.push(["oauth_consumer_secret",auth.consumerSecret]),parameters.push(["oauth_token",auth.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var c={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(c),OAuth.SignatureMethod.sign(c,l);var m=OAuth.getParameterMap(c.parameters);m.oauth_signature=OAuth.percentEncode(m.oauth_signature),console.log(m),$.ajax({url:c.action,data:m,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(e,t,a){processData(e)}})}var auth1={consumerKey:"BeAYtgfFQGaR8ZS32wrskQ",consumerSecret:"fzQMiwgbasP0cYnAgKA1Sxd0JFU",accessToken:"L5qYY71AlaLFvOV9yo4d7XPhUI7RyiDz",accessTokenSecret:"uoDm4tPYFGOp_fWsgMkYxqtZgA8",serviceProvider:{signatureMethod:"HMAC-SHA1"}},auth5={consumerKey:"3kvAWuDWmEDbO2XXoDs9lw",consumerSecret:"0Cz3Qh-_013bC1bzMEFOoRnBNs0",accessToken:"l2L7AKmLGPzr-GVwgNo2nNPijRxpv9jx",accessTokenSecret:"fItZvb98fgcc7wjkL-rO1tO-LuI",serviceProvider:{signatureMethod:"HMAC-SHA1"}},auth6={consumerKey:"9yRKsTpxegI5O2CMQSaxPw",consumerSecret:"KrSdHtKimYfysFW4RRdml19UMmM",accessToken:"5FJ5spnFUo14HhfM1y1AqATf-lOfI7HX",accessTokenSecret:"pOI_E5x1eTy1wI6YcizzulGzYvQ",serviceProvider:{signatureMethod:"HMAC-SHA1"}},auth2={consumerKey:"uAo­UtFYL11MzXdLMe565A",consumerSecret:"1qKxt5FZFt4udBXQFE9u_jHO8z8",accessToken:"qDvg5Dzem9GLTJCGnWGFOG5gryW0LfwQ",accessTokenSecret:"V2HsM3q0l04fSGIX019hwgBGvl8",serviceProvider:{signatureMethod:"HMAC-SHA1"}},auth3={consumerKey:"8NNZ5ajEDKLj_Zs7p7Uj_Q",consumerSecret:"4EvxOA4imilRM2-aiPwoy4qdYmU",accessToken:"Zx75ALaTDWfRChazVBf1-0CV09XjsgnL",accessTokenSecret:"nCvjSZwUuCSCqh2_SNU6WzZK9tQ",serviceProvider:{signatureMethod:"HMAC-SHA1"}},auth4={consumerKey:"nuceAW1zjGXNkQp4sjK",consumerSecret:"qWYAoriy3fufjX9J9jYkmYeH0pI",accessToken:"Q0n1pPIY8fJ_sYeous3JF3Hh250ZvgDM",accessTokenSecret:"3OSJp_QEOPgrpIkEI4lz0qxDp_U",serviceProvider:{signatureMethod:"HMAC-SHA1"}},auth=auth1,currentSearchOffset=0,maxOffset=0;submit_click=function(e){deleteSearchMarks(),deleteInfoWindows(),$("#searchResultPanel").empty(),$("#categorySelect").empty(),distinct=new Array,distinctSolo=new Array,results=new Array,currentSearchOffset=0,maxOffset=0,currentPosLat&&"near me"==$("#location").val()?yelpSearchCurrentLocation($("#term").val(),currentPosLat,currentPosLon,currentSearchOffset,2,items):yelpSearch($("#term").val(),$("#location").val(),currentSearchOffset,2,items)};var deleteBookmarkButton=function(e,t){var a=$("<button class='btn btn-small delete' value="+e+" title='Delete'><i class='icon-trash'></i></button>");return a.click(function(){confirm("Do you really want to delete this bookmark?")&&(bookmark.deleteItem($(this).val()),bookmark.updateAddBookmarkBtn(t))}),a},deleteAllBookmarks=function(){confirm("Do you really want to delete all bookmarks?")&&($("#BookmarkPanel .eachResult").each(function(){var e=$(".locationUrl",$(this)).val(),t=$(".locationId",$(this)).val();bookmark.deleteItem(t),bookmark.updateAddBookmarkBtn(e)}),$(".deleteAllBookmarks").remove(),totalCats=new Array,cats=new Array)},editBookmarkButton=function(e){var t=$("<button class='btn btn-small edit' value="+e+" title='Edit'><i class='icon-edit'></i></button>");return t.click(function(){var e=$(this).val(),t=bookmark.getBookmarkById(e);t?addBookmarkBtnClick(t,null,!0):alert("There is no such bookmark. Error occurred")}),t};